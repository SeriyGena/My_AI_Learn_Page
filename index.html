<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive AI Course Plan for Engineer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Use environment variables provided by the Canvas environment, with a fallback for local development.
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : { apiKey: "YOUR_API_KEY", authDomain: "YOUR_AUTH_DOMAIN", projectId: "YOUR_PROJECT_ID" }; // Placeholder for local dev

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase
        let app, db, auth;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            // Make Firebase services available globally
            window.firestoreDb = db;
            window.firebaseAuth = auth;
            window.currentAppId = appId;
            window.doc = doc;
            window.setDoc = setDoc;
            window.getDoc = getDoc;
            window.onSnapshot = onSnapshot;
            window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
            window.signInWithEmailAndPassword = signInWithEmailAndPassword;
            window.signOut = signOut;


        } catch (e) {
            console.error("Firebase initialization failed:", e);
            document.body.innerHTML = '<div class="h-screen flex items-center justify-center text-red-500">Firebase initialization failed. Please check your configuration.</div>';
        }

        // Authentication and data loading
        if (auth) { // Only run if auth was successfully initialized
            onAuthStateChanged(auth, async (user) => {
                const authStatusElement = document.getElementById('auth-status');
                const userIdDisplayElement = document.getElementById('user-id-display');
                const authControlsLeftElement = document.getElementById('auth-controls-left');
                const authControlsRightElement = document.getElementById('auth-controls-right');
                const loadingIndicator = document.getElementById('loading-indicator');

                if (user) {
                    console.log("User signed in:", user.uid);
                    window.currentUserId = user.uid; // Make userId available globally
                    if (authStatusElement) {
                        authStatusElement.textContent = `Signed in as: ${user.email || 'Anonymous User'}`;
                        authStatusElement.classList.remove('text-red-500');
                        authStatusElement.classList.add('text-green-600');
                    }
                    if (userIdDisplayElement) {
                        // The user ID is no longer displayed on the UI.
                        userIdDisplayElement.textContent = `Your User ID: ${user.uid}`; // Keep the text content for debugging if needed
                    }
                    if (authControlsRightElement) {
                        authControlsRightElement.innerHTML = `
                            <button id="logout-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-2 rounded-md text-sm transition-colors">Log Out</button>
                        `;
                        document.getElementById('logout-button').addEventListener('click', async () => {
                            try {
                                await window.signOut(window.firebaseAuth);
                                console.log("User logged out.");
                                window.completedTasks = new Set();
                                updateTaskCheckboxes();
                                window.updateProgressChart();
                            } catch (error) {
                                console.error("Error logging out:", error);
                            }
                        });
                    }
                    if (authControlsLeftElement) {
                        authControlsLeftElement.innerHTML = ''; // Clear left controls if logged in
                    }
                    // Load completed tasks from Firestore after authentication
                    await window.loadCompletedTasks();
                    window.updateProgressChart(); // Update chart after tasks are loaded
                    window.setupFirestoreListener();
                } else {
                    console.log("No user signed in.");
                    if (authStatusElement) {
                        authStatusElement.textContent = 'Not Signed In';
                        authStatusElement.classList.remove('text-green-600');
                        authStatusElement.classList.add('text-red-500');
                    }
                    if (userIdDisplayElement) {
                        userIdDisplayElement.textContent = 'Your User ID: N/A';
                    }
                    if (authControlsLeftElement) {
                        authControlsLeftElement.innerHTML = `
                            <input type="email" id="email-input" placeholder="Email" class="p-1 border rounded-md w-28 text-sm" value="" autocomplete="off">
                            <input type="password" id="password-input" placeholder="Password" class="p-1 border rounded-md w-28 text-sm" value="" autocomplete="off">
                            <button id="login-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-2 rounded-md text-sm transition-colors w-20">Log In</button>
                            <button id="signup-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-1 px-2 rounded-md text-sm transition-colors w-20 mt-1">Sign Up</button>
                        `;
                        document.getElementById('login-button').addEventListener('click', async () => {
                            const email = document.getElementById('email-input').value;
                            const password = document.getElementById('password-input').value;
                            try {
                                await window.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                                console.log("User logged in with email:", email);
                            } catch (error) {
                                console.error("Login error:", error);
                                authStatusElement.classList.add('text-red-500', 'font-bold');
                                if (error.code === 'auth/operation-not-allowed') {
                                    authStatusElement.innerHTML = 'Error: Email/Password sign-in must be enabled in the Firebase console.';
                                } else {
                                    authStatusElement.textContent = `Login Error: ${error.message}`;
                                }
                            }
                        });
                        document.getElementById('signup-button').addEventListener('click', async () => {
                            const email = document.getElementById('email-input').value;
                            const password = document.getElementById('password-input').value;
                            try {
                                await window.createUserWithEmailAndPassword(window.firebaseAuth, email, password);
                                console.log("User signed up with email:", email);
                            } catch (error) {
                                console.error("Signup error:", error);
                                authStatusElement.classList.add('text-red-500', 'font-bold');
                                if (error.code === 'auth/operation-not-allowed') {
                                    authStatusElement.innerHTML = 'Error: Email/Password sign-up must be enabled in the Firebase console.';
                                } else {
                                    authStatusElement.textContent = `Signup Error: ${error.message}`;
                                }
                            }
                        });
                    }
                    if (authControlsRightElement) {
                        authControlsRightElement.innerHTML = `
                            <button id="anonymous-login-button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-1 px-2 rounded-md text-xs transition-colors w-24">Continue Anonymously</button>
                        `;
                        document.getElementById('anonymous-login-button').addEventListener('click', async () => {
                            try {
                                await signInAnonymously(auth);
                                console.log("Continued anonymously.");
                            } catch (error) {
                                console.error("Anonymous login error:", error);
                                authStatusElement.classList.add('text-red-500', 'font-bold');
                                if (error.code === 'auth/operation-not-allowed') {
                                    authStatusElement.innerHTML = 'Error: Anonymous sign-in must be enabled in the Firebase console.';
                                } else {
                                    authStatusElement.textContent = `Anonymous Login Error: ${error.message}`;
                                }
                            }
                        });
                    }
                }
                // Hide loading indicator once authentication state is determined
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'none';
                }
            });
        } else { // If auth initialization failed
            document.getElementById('auth-status').textContent = 'Firebase Connection Failed';
            document.getElementById('loading-indicator').style.display = 'none';
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .chart-container { position: relative; width: 100%; max-width: 400px; margin: auto; height: auto; max-height: 400px; }
        .nav-link { transition: all 0.3s ease; border-bottom: 2px solid transparent; }
        .nav-link.active { border-bottom-color: #3b82f6; color: #3b82f6; }
        .sub-nav-link { transition: all 0.3s ease; border-bottom: 2px solid transparent; }
        .sub-nav-link.active { border-bottom-color: #10b981; color: #10b981; }
        .module-header { cursor: pointer; transition: background-color 0.3s ease; }
        .module-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; }
        .task-item input:checked + span { text-decoration: line-through; color: #9ca3af; }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="relative mb-8 flex flex-col items-center pt-16 sm:pt-0">
            <!-- Top Left: Email/Password Login & Signup -->
            <div class="absolute top-0 left-0 text-left p-2">
                <div id="auth-controls-left" class="flex flex-col items-start space-y-1">
                    <!-- Email, Password, Login, Signup injected here by JS -->
                </div>
            </div>

            <!-- Top Right: Auth Status & Anonymous Login/Logout -->
            <div class="absolute top-0 right-0 text-right p-2 flex flex-col items-end">
                <div id="auth-status" class="text-sm mt-0 font-medium">Loading...</div>
                <div id="user-id-display" class="text-xs text-gray-500 mt-0 hidden">Your User ID: N/A</div>
                <div id="auth-controls-right" class="flex flex-col sm:flex-row items-end mt-1 space-y-1 sm:space-y-0 sm:space-x-1">
                    <!-- Anonymous login/logout button injected here by JS -->
                </div>
            </div>

            <!-- Centered Main Title -->
            <div class="text-center w-full">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900">AI Eng. skills for non coder</h1>
                <p class="text-md text-gray-600 mt-2">Your Personal Interactive Learning Plan</p>
            </div>
        </header>

        <nav class="flex justify-center border-b border-gray-200 mb-8">
            <button data-target="dashboard" class="nav-link active py-4 px-6 text-sm sm:text-base font-medium text-gray-500 hover:text-blue-500">ðŸš€ Home</button>
            <button data-target="modules" class="nav-link py-4 px-6 text-sm sm:text-base font-medium text-gray-500 hover:text-blue-500">ðŸ“š Modules</button>
            <button data-target="info" class="nav-link py-4 px-6 text-sm sm:text-base font-medium text-gray-500 hover:text-blue-500">ðŸ’¡ Info</button>
        </nav>

        <div id="loading-indicator" class="flex justify-center items-center h-24 text-blue-600 text-lg font-medium">
            Loading course data...
        </div>

        <main id="content-area">
            <!-- Content will be injected here by JavaScript -->
        </main>
    </div>

    <script type="module">
        const courseData = {
            modules: [
                {
                    title: "Module 1: Python Fundamentals for AI & LLM",
                    description: "Setting up the development environment and mastering key data manipulation libraries.",
                    tasks: ["Set up Python environment in VSCode", "Master NumPy basics", "Learn Pandas for data manipulation"]
                },
                {
                    title: "Module 2: 3D Visualization and Interactive Models",
                    description: "Learn to create parametric 3D models and interactive visualizations for analyzing complex technical situations.",
                    tasks: ["Create a parametric 3D model of a component using CadQuery", "Visualize the 3D model using PyVista or Open3D", "Create an interactive web application to control the model in Streamlit"]
                },
                {
                    title: "Module 3: LLMs for Workflow Automation",
                    description: "Utilize the power of large language models to automate routine tasks: reports, documentation, and presentations.",
                    tasks: ["Automatically generate an equipment status report", "Summarize extensive technical documentation using an LLM", "Generate content for a technical presentation"]
                },
                {
                    title: "Module 4: Failure Classification and Budget Forecasting",
                    description: "Apply machine learning for predictive maintenance and financial planning.",
                    tasks: ["Build a failure classification model using Scikit-learn", "Integrate the model into a monitoring system simulation", "Build a budget forecasting model based on time series data"]
                },
                {
                    title: "Module 5: AI Agents for Personal Use",
                    description: "Create personal AI agents for financial management and information tracking.",
                    tasks: ["Create an AI agent for stock monitoring using yfinance", "Develop an agent for personal budget management (CSV/SQLite)", "Explore multi-agent architecture for complex tasks"]
                },
                {
                    title: "Module 6: Using LLM APIs and Popular Services",
                    description: "Learn to integrate your applications with leading LLMs and popular web services to extend their functionality.",
                    tasks: ["Write scripts to interact with OpenAI, Google Gemini, Anthropic APIs", "Write scripts to interact with Mistral and Meta Llama 3 APIs", "Complete 2-3 integration projects with APIs (e.g., OpenWeatherMap, YouTube, Notion)"]
                }
            ],
            skills: {
                labels: ['3D Viz', 'Data Analysis', 'ML', 'LLM', 'Agents', 'APIs'],
                values: [8, 7, 9, 10, 9, 8]
            }
        };

        const contentArea = document.getElementById('content-area');
        const navLinks = document.querySelectorAll('.nav-link');
        let progressChart, skillsChart;
        window.completedTasks = new Set();

        // --- Firestore Data Functions ---
        window.saveCompletedTasks = async () => {
            if (!window.firestoreDb || !window.currentUserId) return;
            try {
                const docRef = window.doc(window.firestoreDb, 'artifacts', window.currentAppId, 'users', window.currentUserId, 'ai_course_progress', 'tasks');
                await window.setDoc(docRef, { tasks: Array.from(window.completedTasks) });
            } catch (e) {
                console.error("Error saving to Firestore: ", e);
            }
        };

        window.loadCompletedTasks = async () => {
            if (!window.firestoreDb || !window.currentUserId) return;
            try {
                const docRef = window.doc(window.firestoreDb, 'artifacts', window.currentAppId, 'users', window.currentUserId, 'ai_course_progress', 'tasks');
                const docSnap = await window.getDoc(docRef);
                if (docSnap.exists() && docSnap.data().tasks) {
                    window.completedTasks = new Set(docSnap.data().tasks);
                } else {
                    window.completedTasks = new Set();
                }
            } catch (e) {
                console.error("Error loading from Firestore: ", e);
                window.completedTasks = new Set();
            }
            updateTaskCheckboxes();
            updateProgressChart();
        };

        window.setupFirestoreListener = () => {
            if (!window.firestoreDb || !window.currentUserId) return;
            const docRef = window.doc(window.firestoreDb, 'artifacts', window.currentAppId, 'users', window.currentUserId, 'ai_course_progress', 'tasks');
            window.onSnapshot(docRef, (doc) => {
                if (doc.exists() && doc.data().tasks) {
                    const newTasks = new Set(doc.data().tasks);
                    if (JSON.stringify([...newTasks]) !== JSON.stringify([...window.completedTasks])) {
                        window.completedTasks = newTasks;
                        console.log("Real-time update received.");
                        updateTaskCheckboxes();
                        updateProgressChart();
                    }
                }
            });
        };
        
        // --- UI Rendering ---
        const templates = {
            dashboard: `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                    <div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-2xl font-bold mb-4 text-center">Course Overview</h2><p class="text-gray-600 leading-relaxed">This interactive plan will guide you through key modules, from Python fundamentals to building AI applications. Track your progress and watch your competencies grow!</p></div>
                    <div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-2xl font-bold mb-4 text-center">Your Progress</h2><div class="chart-container h-64 md:h-72"><canvas id="progressChart"></canvas></div></div>
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md"><h2 class="text-2xl font-bold mb-4 text-center">Skills Map</h2><div class="chart-container h-64 md:h-80"><canvas id="skillsChart"></canvas></div></div>
                </div>`,
            modules: `
                <h2 class="text-2xl font-bold mb-6 text-center">Learning Modules</h2>
                <div id="modules-container" class="space-y-4">
                    ${courseData.modules.map((module, index) => `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="module-header p-4 sm:p-6 flex justify-between items-center bg-gray-50 hover:bg-gray-100">
                                <h3 class="text-lg font-semibold text-gray-800">${module.title}</h3>
                                <span class="transform transition-transform duration-300 text-blue-500">â–¼</span>
                            </div>
                            <div class="module-content"><div class="p-4 sm:p-6 border-t"><p class="text-gray-600 mb-4">${module.description}</p><h4 class="font-semibold mb-2">Tasks:</h4><ul class="space-y-2">
                                ${module.tasks.map((task, taskIndex) => `
                                    <li class="task-item"><label class="flex items-center cursor-pointer"><input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" data-task-id="${index}-${taskIndex}"><span class="ml-3 text-gray-700">${task}</span></label></li>
                                `).join('')}
                            </ul></div></div>
                        </div>`).join('')}
                </div>`,
            info: `
                <h2 class="text-2xl font-bold mb-6 text-center">Additional Information</h2>
                <div id="info-sub-content" class="bg-white p-6 rounded-xl shadow-md">
                    <p>This section would contain additional info like tools and resources.</p>
                </div>`
        };

        window.renderContent = (target) => {
            contentArea.innerHTML = templates[target];
            if (target === 'dashboard') renderDashboardCharts();
            if (target === 'modules') attachModuleListeners();
        };

        window.updateProgressChart = () => {
            const chartEl = document.getElementById('progressChart');
            if (!chartEl) return;
            const totalTasks = courseData.modules.reduce((acc, module) => acc + module.tasks.length, 0);
            const completedCount = window.completedTasks.size;
            if (progressChart) progressChart.destroy();
            progressChart = new Chart(chartEl.getContext('2d'), {
                type: 'doughnut',
                data: { labels: ['Completed', 'Remaining'], datasets: [{ data: [completedCount, totalTasks - completedCount], backgroundColor: ['#3b82f6', '#e5e7eb'], borderWidth: 4, borderColor: '#f8f9fa' }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false } } }
            });
        };

        function renderDashboardCharts() {
            window.updateProgressChart();
            const skillsCtx = document.getElementById('skillsChart')?.getContext('2d');
            if (!skillsCtx) return;
            if (skillsChart) skillsChart.destroy();
            skillsChart = new Chart(skillsCtx, {
                type: 'radar',
                data: { labels: courseData.skills.labels, datasets: [{ label: 'Competency', data: courseData.skills.values, backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: '#3b82f6', borderWidth: 2 }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { suggestedMin: 0, suggestedMax: 10 } }, plugins: { legend: { display: false } } }
            });
        }
        
        function updateTaskCheckboxes() {
            document.querySelectorAll('.task-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = window.completedTasks.has(checkbox.dataset.taskId);
            });
        }

        function attachModuleListeners() {
            updateTaskCheckboxes();
            document.querySelectorAll('.module-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('span');
                    const isOpening = !content.style.maxHeight || content.style.maxHeight === '0px';
                    document.querySelectorAll('.module-content').forEach(c => c.style.maxHeight = '0px');
                    document.querySelectorAll('.module-header span').forEach(i => i.style.transform = 'rotate(0deg)');
                    if (isOpening) {
                        content.style.maxHeight = content.scrollHeight + "px";
                        icon.style.transform = 'rotate(180deg)';
                    }
                });
            });
            document.querySelectorAll('.task-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const taskId = e.target.dataset.taskId;
                    e.target.checked ? window.completedTasks.add(taskId) : window.completedTasks.delete(taskId);
                    window.saveCompletedTasks();
                    updateProgressChart();
                });
            });
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                const target = e.target.dataset.target;
                navLinks.forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
                window.renderContent(target);
            });
        });
        
        // Initial render on page load
        window.addEventListener('load', () => {
             renderContent('dashboard');
        });
    </script>
</body>
</html>
