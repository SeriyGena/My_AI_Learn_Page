<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive AI Course Plan for Engineer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Import data from separate files
        // These imports are crucial for loading data from external JS files.
        // Ensure these files exist in the 'content/' directory on your GitHub.
        import { resourcesData } from './content/resources_data.js';
        import { toolsData } from './content/tools_data.js';

        // Your web app's Firebase configuration (obtained from Firebase Project Settings)
        // This configuration is hardcoded here for deployment on GitHub Pages.
        // It's essential for your site to connect to YOUR Firebase project.
        const firebaseConfig = {
            apiKey: "AIzaSyB7oxoQua0Wgqzl2IbwL1Uzx-N7hcAnuLw",
            authDomain: "ai-skills-for-non-coder-engs.firebaseapp.com",
            projectId: "ai-skills-for-non-coder-engs",
            storageBucket: "ai-skills-for-non-coder-engs.firebasestorage.app",
            messagingSenderId: "1026548286381",
            appId: "1:1026548286381:web:706b379a6ac131dfb2d724",
            measurementId: "G-6QL2CKNTX6" // Measurement ID is optional for basic Firebase usage
        };

        // Initialize Firebase
        let app, db, auth;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            // Export Firebase instances and Firestore functions for use in global scope
            window.firebaseApp = app;
            window.firestoreDb = db;
            window.firebaseAuth = auth;
            window.currentAppId = firebaseConfig.appId; // Use appId from your specific configuration
            window.initialAuthToken = null; // Not needed for GitHub Pages, as we're doing anonymous sign-in directly

            // Export Firestore functions globally
            window.doc = doc;
            window.setDoc = setDoc;
            window.getDoc = getDoc;
            window.onSnapshot = onSnapshot;
            window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
            window.signInWithEmailAndPassword = signInWithEmailAndPassword;
            window.signOut = signOut;

        } catch (e) {
            console.error("Firebase initialization failed:", e);
            // If Firebase fails to initialize, ensure global variables are null to prevent further errors
            window.firebaseApp = null;
            window.firestoreDb = null;
            window.firebaseAuth = null;
            window.currentAppId = null;
            window.initialAuthToken = null;
            window.doc = null;
            window.setDoc = null;
            window.getDoc = null;
            window.onSnapshot = null;
            window.createUserWithEmailAndPassword = null;
            window.signInWithEmailAndPassword = null;
            window.signOut = null;
        }


        // Authentication and data loading
        if (auth) { // Only run if auth was successfully initialized
            onAuthStateChanged(auth, async (user) => {
                const authStatusElement = document.getElementById('auth-status');
                const userIdDisplayElement = document.getElementById('user-id-display'); // Hidden by default
                const authControlsElement = document.getElementById('auth-controls');
                const mainContentArea = document.getElementById('content-area'); // Get main content area

                if (user) {
                    console.log("User signed in:", user.uid);
                    window.currentUserId = user.uid; // Make userId available globally
                    if (authStatusElement) {
                        authStatusElement.textContent = `Signed in as: ${user.email || 'Anonymous User'}`;
                        authStatusElement.classList.remove('text-red-500');
                        authStatusElement.classList.add('text-green-600');
                    }
                    // User ID is hidden by default, but available in console
                    if (userIdDisplayElement) {
                        userIdDisplayElement.textContent = `User ID: ${user.uid}`;
                        // userIdDisplayElement.style.display = 'none'; // Ensure it's hidden if not already
                    }
                    if (authControlsElement) {
                        authControlsElement.innerHTML = `
                            <button id="logout-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-md transition-colors text-sm">Log Out</button>
                        `;
                        document.getElementById('logout-button').addEventListener('click', async () => {
                            try {
                                await window.signOut(window.firebaseAuth);
                                console.log("User logged out.");
                                // Optionally, clear local progress if desired after logout
                                completedTasks = new Set();
                                updateTaskCheckboxes();
                                window.updateProgressChart();
                            } catch (error) {
                                console.error("Error logging out:", error);
                            }
                        });
                    }
                    // Load completed tasks from Firestore after authentication
                    await window.loadCompletedTasks();
                    window.updateProgressChart(); // Update chart after tasks are loaded
                } else {
                    console.log("No user signed in. Attempting anonymous sign-in.");
                    if (authStatusElement) {
                        authStatusElement.textContent = 'Not Signed In';
                        authStatusElement.classList.remove('text-green-600');
                        authStatusElement.classList.add('text-red-500');
                    }
                    if (userIdDisplayElement) {
                        userIdDisplayElement.textContent = 'User ID: N/A';
                        // userIdDisplayElement.style.display = 'none'; // Ensure it's hidden if not already
                    }
                    if (authControlsElement) {
                        authControlsElement.innerHTML = `
                            <input type="email" id="email-input" placeholder="Email" class="p-2 border rounded-md w-32 sm:w-28 mb-2 sm:mb-0 sm:mr-2 text-sm">
                            <input type="password" id="password-input" placeholder="Password" class="p-2 border rounded-md w-32 sm:w-28 mb-2 sm:mb-0 sm:mr-2 text-sm">
                            <button id="login-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 rounded-md transition-colors text-sm mb-2 sm:mb-0 sm:mr-2">Log In</button>
                            <button id="signup-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-3 rounded-md transition-colors text-sm">Sign Up</button>
                            <button id="anonymous-login-button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-3 rounded-md transition-colors text-sm mt-2">Continue Anonymously</button>
                        `;
                        document.getElementById('login-button').addEventListener('click', async () => {
                            const email = document.getElementById('email-input').value;
                            const password = document.getElementById('password-input').value;
                            try {
                                await window.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                                console.log("User logged in with email:", email);
                            } catch (error) {
                                console.error("Login error:", error);
                                authStatusElement.textContent = `Login Error: ${error.message}`;
                            }
                        });
                        document.getElementById('signup-button').addEventListener('click', async () => {
                            const email = document.getElementById('email-input').value;
                            const password = document.getElementById('password-input').value;
                            try {
                                await window.createUserWithEmailAndPassword(window.firebaseAuth, email, password);
                                console.log("User signed up with email:", email);
                            } catch (error) {
                                console.error("Signup error:", error);
                                authStatusElement.textContent = `Signup Error: ${error.message}`;
                            }
                        });
                        document.getElementById('anonymous-login-button').addEventListener('click', async () => {
                            try {
                                await signInAnonymously(auth);
                                console.log("Continued anonymously.");
                            } catch (error) {
                                console.error("Anonymous login error:", error);
                                authStatusElement.textContent = `Anonymous Login Error: ${error.message}`;
                            }
                        });
                    }
                    // Attempt anonymous sign-in by default if no explicit user is logged in
                    // This is handled by the onAuthStateChanged callback itself, which will trigger signInAnonymously
                    // if no user is found. No need for an explicit call here unless we want to force it immediately.
                }
                // Hide loading indicator and show main content after authentication state is determined and initial data loaded
                const loadingIndicator = document.getElementById('loading-indicator');
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'none';
                }
                if (mainContentArea) {
                    mainContentArea.classList.remove('hidden'); // Show main content
                }
            });
        } else { // If auth initialization failed
            const authStatusElement = document.getElementById('auth-status');
            const userIdDisplayElement = document.getElementById('user-id-display');
            const authControlsElement = document.getElementById('auth-controls');
            const mainContentArea = document.getElementById('content-area'); // Get main content area

            if (authStatusElement) {
                authStatusElement.textContent = 'Firebase Not Configured / Connection Failed';
                authStatusElement.classList.remove('text-green-600');
                authStatusElement.classList.add('text-red-500');
            }
            if (userIdDisplayElement) {
                userIdDisplayElement.textContent = 'User ID: Not Available';
                // userIdDisplayElement.style.display = 'none'; // Ensure it's hidden if not already
            }
            if (authControlsElement) {
                authControlsElement.innerHTML = `
                    <p class="text-red-500 text-sm">Authentication features are unavailable due to Firebase configuration issues.</p>
                `;
            }
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
            if (mainContentArea) {
                mainContentArea.classList.remove('hidden'); // Show main content even if Firebase failed
            }
        }
    </script>

    <!-- Chosen Palette: Calm Harmony Neutrals -->
    <!-- Application Structure Plan: I designed the application as an interactive dashboard with tabs (Home, Modules, Tools, Resources, Deployment). This structure provides non-linear access to information, allowing the user to easily switch between a general progress overview, detailed module content, and reference materials. This is more convenient and intuitive than scrolling through a long document, as it encourages active exploration and allows focusing on specific topics of interest at any time. -->
    <!-- Visualization & Content Choices:
        1. Report Information: Overall course structure and tasks -> Goal: Visualize progress and acquired skills -> Visualization: Doughnut chart (Chart.js) for overall progress and Radar chart (Chart.js) for skills. -> Interactivity: Progress chart updates when tasks are marked as completed. -> Justification: Instant visual feedback motivates and provides a clear understanding of the journey completed and future competencies.
        2. Report Information: Module sections -> Goal: Structuring learning content -> Presentation: Interactive accordion cards. -> Interactivity: Clicking on a module header expands its detailed content. -> Justification: Prevents information overload ("wall of text"), making navigation through course content manageable and clear. Implemented with JS.
        3. Report Information: Lists of libraries, APIs, LLMs -> Goal: Create a quick reference guide -> Presentation: Styled cards in a grid layout. -> Interactivity: Clicking on a card could display additional information in the future. -> Justification: Transforms simple lists into a useful, easily browsable reference section. Implemented with HTML/Tailwind.
        4. New Section: Site Deployment -> Goal: Provide practical steps for hosting the web application -> Presentation: Detailed list of steps for GitHub Pages, Netlify, Vercel. -> Interactivity: Informational, with clear steps for user action outside the app. -> Justification: Addresses user's direct query about deployment, making the course plan actionable beyond just content. Implemented with HTML/Tailwind.
        5. New Feature: Individual Progress Tracking -> Goal: Persist and track checklist status for each unique user -> Presentation: Checkboxes within module tasks, progress charts. -> Interactivity: Checkbox clicks update Firestore for the specific user's document; changes update UI. -> Justification: Addresses user's request for individual, persistent progress.
        6. New Feature: Authentication Status Display & User ID -> Goal: Visually inform user about authentication status and their unique ID -> Presentation: Small text indicator in the header, displaying full user ID. -> Interactivity: Updates dynamically based on Firebase auth state. -> Justification: Clearly shows the user their unique identifier for tracking their own progress.
        7. New Feature: Local Progress Fallback -> Goal: Allow functionality to be seen even without Firebase setup. -> Presentation: Checkbox and chart updates. -> Interactivity: Updates `completedTasks` Set and UI locally. -> Justification: Addresses user's request to preserve functionality visibility without immediate Firestore setup.
        8. New Feature: Email/Password Authentication -> Goal: Allow users to create accounts and log in for persistent profiles. -> Presentation: Login/Signup form and buttons. -> Interactivity: User input for email/password, Firebase Auth calls. -> Justification: Provides explicit user accounts as requested.
        9. New Feature: Grouping Resources and Deployment under "Info" tab. -> Goal: Organize navigation and allow external content loading. -> Presentation: New "Info" tab with sub-navigation and dynamic content area. -> Interactivity: Clicking "Info" reveals sub-menu; clicking sub-menu items loads content from external HTML files. -> Justification: Improves navigation and allows modular content updates.
        10. UI/UX Enhancements: Positioning auth controls to top-right, making input/buttons smaller, improving header layout. -> Goal: Enhance visual appeal and prevent element overlap. -> Presentation: Updated CSS for header elements and Tailwind classes for inputs/buttons. -> Interactivity: Improved visual clarity. -> Justification: Addresses user's direct feedback on design issues.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: auto;
            max-height: 400px;
        }
        .nav-link {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
        }
        .module-header {
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .module-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
        .task-item input:checked + span {
            text-decoration: line-through;
            color: #9ca3af;
        }
        /* Initial styling for loading indicator */
        #loading-indicator {
            display: flex; /* Changed from none to flex for initial visibility */
            justify-content: center;
            align-items: center;
            height: 100vh; /* Full viewport height */
            width: 100vw;  /* Full viewport width */
            position: fixed; /* Fixed position to cover entire screen */
            top: 0;
            left: 0;
            background-color: rgba(255, 255, 255, 0.9); /* Semi-transparent white background */
            z-index: 1000; /* Ensure it's on top of everything */
            font-size: 1.2em;
            color: #3b82f6;
        }
        /* New styles for positioning auth status and controls */
        header {
            position: relative; /* Make header a positioning context for absolute children */
            padding-bottom: 1rem; /* Default padding bottom */
            text-align: center; /* Center the main header text */
        }

        .header-main-content {
            text-align: center;
            margin-bottom: 1rem; /* Space below title content */
        }

        .auth-section-wrapper {
            position: absolute;
            top: 1rem; /* Distance from the top of the container */
            right: 1rem; /* Distance from the right of the container */
            display: flex;
            flex-direction: column;
            align-items: flex-end; /* Align elements to the right */
            gap: 0.5rem;
            z-index: 10;
            max-width: 50%; /* Constrain width to prevent overlap with h1 on larger screens */
            text-align: right; /* Ensure text inside is right-aligned */
        }
        
        /* Ensure main header content doesn't get pushed by absolute positioning */
        /* This is the key fix for overlap */
        .container.mx-auto.relative > header {
            padding-top: 80px; /* Adjust this value based on the height of your auth controls */
            /* This pushes down the main header content to make space for the absolutely positioned auth controls */
        }


        /* Adjust auth controls for better spacing and stacking on small screens */
        #auth-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        #auth-controls input,
        #auth-controls button {
            flex-grow: 1;
            min-width: 100px;
        }

        @media (max-width: 768px) { /* Adjust breakpoint for mobile */
            .auth-section-wrapper {
                position: static; /* Remove absolute positioning on mobile */
                width: 100%; /* Take full width */
                align-items: center; /* Center align items */
                margin-top: 1rem; /* Add space below main header content */
                text-align: center; /* Center text */
                max-width: 100%; /* Full width on mobile */
                padding-left: 0;
                padding-right: 0;
            }
            #auth-controls {
                flex-direction: column; /* Stack buttons vertically */
                width: 100%;
                gap: 0.5rem;
            }
            #auth-controls input,
            #auth-controls button {
                width: 100% !important; /* Force full width on mobile */
                margin-right: 0 !important; /* Remove any lingering right margin */
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 relative">
        <header class="mb-8">
            <div class="header-main-section">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900">AI Eng. skills for non coder test_04</h1>
                <p class="text-md text-gray-600 mt-2 font-semibold text-lg tracking-wide">Your Personal Interactive Learning Plan</p>
            </div>
            
            <div class="auth-section-wrapper">
                <div id="auth-status" class="text-sm font-medium">Loading authentication status...</div>
                <div id="user-id-display" class="text-xs text-gray-500 mt-1 hidden">Your User ID: N/A</div> <!-- Hidden by default -->
                <div id="auth-controls" class="flex flex-col sm:flex-row justify-end items-center mt-2 space-y-2 sm:space-y-0 sm:space-x-2">
                    <!-- Auth controls will be injected here by JavaScript -->
                </div>
            </div>
        </header>

        <nav class="flex justify-center border-b border-gray-200 mb-8">
            <button data-target="dashboard" class="nav-link active py-4 px-6 text-sm sm:text-base font-medium text-gray-500 hover:text-blue-500">üöÄ Home</button>
            <button data-target="modules" class="nav-link py-4 px-6 text-sm sm:text-base font-medium text-gray-500 hover:text-blue-500">üìö Modules</button>
            <button data-target="info" class="nav-link py-4 px-6 text-sm sm:text-base font-medium text-gray-500 hover:text-blue-500">‚ÑπÔ∏è Info</button>
        </nav>

        <!-- Full-page loading indicator -->
        <div id="loading-indicator" class="fixed inset-0 bg-white flex justify-center items-center z-50">
            <p class="text-blue-600 text-lg font-medium">Loading course data...</p>
        </div>

        <main id="content-area" class="hidden"> <!-- Initially hidden -->
            <!-- Content will be injected here by JavaScript -->
        </main>

    </div>

    <script type="module">
        // Ensure Firebase instances are available after initial script loads and authenticates
        // This part runs after the initial Firebase setup in the head script
        const courseData = {
            modules: [
                {
                    title: "Module 1: Python Fundamentals for AI & LLM",
                    description: "Setting up the development environment and mastering key data manipulation libraries, which forms the foundation for all subsequent topics.",
                    tasks: [
                        "Set up Python development environment in VSCode",
                        "Install JupyterLab for interactive work",
                        "Master NumPy basics for numerical operations",
                        "Learn Pandas for data manipulation and analysis"
                    ]
                },
                {
                    title: "Module 2: 3D Visualization and Interactive Models",
                    description: "Learn to create parametric 3D models and interactive visualizations for analyzing complex technical situations.",
                    tasks: [
                        "Create a parametric 3D model of a component using CadQuery",
                        "Visualize the 3D model using PyVista or Open3D",
                        "Create an interactive web application to control the model in Streamlit"
                    ]
                },
                {
                    title: "Module 3: LLMs for Workflow Automation",
                    description: "Utilize the power of large language models to automate routine tasks: reports, documentation, and presentations.",
                    tasks: [
                        "Automatically generate an equipment status report",
                        "Summarize extensive technical documentation using an LLM",
                        "Generate content for a technical presentation"
                    ]
                },
                {
                    title: "Module 4: Failure Classification and Budget Forecasting",
                    description: "Apply machine learning for predictive maintenance and financial planning.",
                    tasks: [
                        "Build a failure classification model using Scikit-learn",
                        "Integrate the model into a monitoring system simulation",
                        "Build a budget forecasting model based on time series data"
                    ]
                },
                {
                    title: "Module 5: AI Agents for Personal Use",
                    description: "Create personal AI agents for financial management and information tracking.",
                    tasks: [
                        "Create an AI agent for stock monitoring using yfinance",
                        "Develop an agent for personal budget management (CSV/SQLite)",
                        "Explore multi-agent architecture for complex tasks"
                    ]
                },
                {
                    title: "Module 6: Using LLM APIs and Popular Services",
                    description: "Learn to integrate your applications with leading LLMs and popular web services to extend their functionality.",
                    tasks: [
                        "Write scripts to interact with OpenAI, Google Gemini, Anthropic APIs",
                        "Write scripts to interact with Mistral and Meta Llama 3 APIs",
                        "Complete 2-3 integration projects with APIs (e.g., OpenWeatherMap, YouTube, Notion)"
                    ]
                }
            ],
            skills: {
                labels: ['3D Visualization', 'Data Analysis', 'Machine Learning', 'LLM & Prompting', 'Agent Development', 'API Integration'],
                values: [8, 7, 9, 10, 9, 8]
            },
            // tools and resources data are now imported from separate files
            tools: {}, // This will be populated by imported toolsData
            resources: [] // This will be populated by imported resourcesData
        };

        // Populate courseData with imported data after it's defined
        Object.assign(courseData.tools, toolsData);
        courseData.resources = resourcesData;


        const contentArea = document.getElementById('content-area');
        const navLinks = document.querySelectorAll('.nav-link');
        let progressChart, skillsChart;
        let completedTasks = new Set(); // Stores task IDs like "0-0", "0-1"

        // Firestore functions
        window.saveCompletedTasks = async () => {
            // Always update local state and UI first
            updateTaskCheckboxes();
            window.updateProgressChart();

            if (!window.firestoreDb || !window.currentAppId || !window.currentUserId || !window.doc || !window.setDoc) {
                console.warn("Firestore not fully initialized or user not authenticated. Progress will not be persisted.");
                return; // Exit if Firestore is not ready for persistence
            }
            try {
                // Individual user progress path: artifacts/{appId}/users/{userId}/ai_course_progress
                const docRef = window.doc(window.firestoreDb, 'artifacts', window.currentAppId, 'users', window.currentUserId, 'ai_course_progress');
                await window.setDoc(docRef, { tasks: Array.from(completedTasks) }, { merge: true });
                console.log("Tasks saved to Firestore for user:", window.currentUserId);
            } catch (e) {
                console.error("Error saving document to Firestore: ", e);
            }
        };

        window.loadCompletedTasks = async () => {
            if (!window.firestoreDb || !window.currentAppId || !window.currentUserId || !window.getDoc || !window.doc) {
                console.warn("Firestore not fully initialized or user not authenticated. Cannot load persisted tasks.");
                completedTasks = new Set(); // Ensure local state is clear if no persistence
                updateTaskCheckboxes(); // Update UI based on local (empty) state
                window.updateProgressChart(); // Update chart based on local (empty) state
                return; // Exit if Firestore is not ready for loading
            }
            try {
                // Individual user progress path: artifacts/{appId}/users/{userId}/ai_course_progress
                const docRef = window.doc(window.firestoreDb, 'artifacts', window.currentAppId, 'users', window.currentUserId, 'ai_course_progress');
                const docSnap = await window.getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data && Array.isArray(data.tasks)) {
                        completedTasks = new Set(data.tasks);
                        console.log("Tasks loaded from Firestore for user:", window.currentUserId, completedTasks);
                        // Update UI after loading
                        updateTaskCheckboxes();
                    }
                } else {
                    console.log("No saved progress found in Firestore for user:", window.currentUserId);
                    completedTasks = new Set(); // Clear local tasks if no saved data
                }
            } catch (e) {
                console.error("Error loading document from Firestore: ", e);
                completedTasks = new Set(); // Clear local tasks on error
            } finally {
                updateTaskCheckboxes(); // Always ensure UI is updated
                window.updateProgressChart(); // Always ensure chart is updated
            }
        };

        // Real-time listener for individual user progress
        window.setupFirestoreListener = () => {
             if (!window.firestoreDb || !window.currentAppId || !window.currentUserId || !window.onSnapshot || !window.doc) {
                console.warn("Firestore not fully initialized or user not authenticated. Cannot set up real-time listener.");
                return; // Exit if Firestore is not ready for listener
            }
            // Individual user progress path: artifacts/{appId}/users/{userId}/ai_course_progress
            const docRef = window.doc(window.firestoreDb, 'artifacts', window.currentAppId, 'users', window.currentUserId, 'ai_course_progress');
            window.onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data && Array.isArray(data.tasks)) {
                        const newCompletedTasks = new Set(data.tasks);
                        // Only update if there are actual changes to avoid infinite loops
                        if (JSON.stringify(Array.from(completedTasks)) !== JSON.stringify(Array.from(newCompletedTasks))) {
                            completedTasks = newCompletedTasks;
                            console.log("Real-time update from Firestore for user:", window.currentUserId, completedTasks);
                            updateTaskCheckboxes();
                            updateProgressChart();
                        }
                    }
                } else {
                    console.log("Document does not exist in real-time listener for user:", window.currentUserId);
                    completedTasks = new Set(); // Clear tasks if document is deleted
                    updateTaskCheckboxes();
                    updateProgressChart();
                }
            }, (error) => {
                console.error("Error listening to document: ", error);
            });
        };


        const templates = {
            dashboard: `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold mb-4 text-center">Course Overview</h2>
                        <p class="text-gray-600 leading-relaxed">
                            This interactive plan will guide you through six key modules, starting from Python fundamentals and progressing to building complex AI agents and integrating with leading global APIs. Your goal is not just to learn theory, but to gain practical skills that you can immediately apply in your engineering work and personal projects. Track your progress and watch your competencies grow!
                        </p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold mb-4 text-center">Your Progress</h2>
                        <p class="text-center text-sm text-gray-500 mb-4">Note: Your progress is tracked individually based on your unique User ID. Persistence requires <a href="#deployment" class="text-blue-500 hover:underline">Firestore setup</a>.</p>
                        <div class="chart-container h-64 md:h-72">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold mb-4 text-center">Skills Map</h2>
                        <p class="text-center text-gray-600 mb-4">A visualization of the key competencies you will acquire.</p>
                        <div class="chart-container h-64 md:h-80">
                            <canvas id="skillsChart"></canvas>
                        </div>
                    </div>
                </div>
            `,
            modules: `
                <h2 class="text-2xl font-bold mb-6 text-center">Learning Modules</h2>
                <div id="modules-container" class="space-y-4">
                    ${courseData.modules.map((module, index) => `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="module-header p-4 sm:p-6 flex justify-between items-center bg-gray-50 hover:bg-gray-100" data-module-index="${index}">
                                <h3 class="text-lg font-semibold text-gray-800">${module.title}</h3>
                                <span class="transform transition-transform duration-300 text-blue-500">‚ñº</span>
                            </div>
                            <div class="module-content">
                                <div class="p-4 sm:p-6 border-t border-gray-200">
                                    <p class="text-gray-600 mb-4">${module.description}</p>
                                    <h4 class="font-semibold mb-2">Practical Tasks:</h4>
                                    <ul class="space-y-2">
                                        ${module.tasks.map((task, taskIndex) => `
                                            <li class="task-item flex items-center">
                                                <label class="flex items-center cursor-pointer">
                                                    <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" data-task-id="${index}-${taskIndex}">
                                                    <span class="ml-3 text-gray-700">${task}</span>
                                                </label>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `,
            // New 'Info' tab template with sub-navigation and content area
            info: `
                <div class="flex flex-col md:flex-row gap-6">
                    <div id="info-sidebar" class="md:w-1/4 bg-white p-4 rounded-xl shadow-md flex flex-col space-y-2">
                        <button data-sub-target="resources" class="sub-nav-link text-left py-2 px-4 rounded-md hover:bg-gray-100 font-medium text-gray-700">üéì Resources</button>
                        <button data-sub-target="deployment" class="sub-nav-link text-left py-2 px-4 rounded-md hover:bg-gray-100 font-medium text-gray-700">üåê Deployment</button>
                        <button data-sub-target="tools" class="sub-nav-link text-left py-2 px-4 rounded-md hover:bg-gray-100 font-medium text-gray-700">üõ†Ô∏è Tools</button>
                        <!-- Future sections can be added here -->
                    </div>
                    <div id="info-content-area" class="md:w-3/4 bg-white p-6 rounded-xl shadow-md min-h-[400px]">
                        <!-- Content loaded dynamically here -->
                    </div>
                </div>
            `
        };

        function renderContent(target) {
            contentArea.innerHTML = templates[target];
            if (target === 'dashboard') {
                renderDashboardCharts();
            } else if (target === 'modules') {
                attachModuleListeners();
            } else if (target === 'info') { // Handle the new 'info' tab
                attachInfoSubNavListeners();
                // Load resources by default when 'info' tab is opened
                loadExternalContent('info-content-area', 'content/resources.html');
            }
        }

        // Function to load external HTML content
        async function loadExternalContent(targetElementId, filePath) {
            const targetElement = document.getElementById(targetElementId);
            if (!targetElement) {
                console.error(`Target element with ID '${targetElementId}' not found.`);
                return;
            }
            targetElement.innerHTML = '<p class="text-center text-blue-500">Loading content...</p>'; // Loading indicator

            try {
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const htmlContent = await response.text();
                targetElement.innerHTML = htmlContent;
            } catch (error) {
                console.error(`Failed to load content from ${filePath}:`, error);
                targetElement.innerHTML = `<p class="text-center text-red-500">Failed to load content. Please ensure '${filePath}' exists and is accessible.</p>`;
            }
        }

        // Attach listeners for the new 'Info' sub-navigation
        function attachInfoSubNavListeners() {
            const subNavButtons = document.querySelectorAll('#info-sidebar .sub-nav-link');
            const infoContentArea = document.getElementById('info-content-area'); // Ensure this element exists

            subNavButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const subTarget = button.dataset.subTarget;
                    // Remove active class from all sub-nav buttons
                    subNavButtons.forEach(btn => btn.classList.remove('active', 'bg-gray-200'));
                    // Add active class to the clicked button
                    button.classList.add('active', 'bg-gray-200');

                    if (subTarget === 'resources') {
                        loadExternalContent('info-content-area', 'content/resources.html');
                    } else if (subTarget === 'deployment') {
                        loadExternalContent('info-content-area', 'content/deployment.html');
                    } else if (subTarget === 'tools') { // Handle loading for tools.html
                        loadExternalContent('info-content-area', 'content/tools.html');
                    }
                });
            });
            // Automatically click the first sub-nav button to load default content (Resources)
            if (subNavButtons.length > 0) {
                subNavButtons[0].click();
            }
        }

        window.updateProgressChart = () => { // Made global for access from Firebase auth
            if (!document.getElementById('progressChart')) return; // Ensure element exists
            const totalTasks = courseData.modules.reduce((acc, module) => acc + module.tasks.length, 0);
            const completedCount = completedTasks.size;

            const progressCtx = document.getElementById('progressChart').getContext('2d');
            if (progressChart) progressChart.destroy(); // Destroy existing chart before creating a new one
            progressChart = new Chart(progressCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Remaining'],
                    datasets: [{
                        data: [completedCount, totalTasks - completedCount],
                        backgroundColor: ['#3b82f6', '#e5e7eb'],
                        borderColor: '#f8f9fa',
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });
        };

        function renderDashboardCharts() {
            window.updateProgressChart(); // Call the global function
            
            if (!document.getElementById('skillsChart')) return; // Ensure element exists
            const skillsCtx = document.getElementById('skillsChart').getContext('2d');
            if (skillsChart) skillsChart.destroy(); // Destroy existing chart before creating a new one
            skillsChart = new Chart(skillsCtx, {
                type: 'radar',
                data: {
                    labels: courseData.skills.labels,
                    datasets: [{
                        label: 'Competency Level',
                        data: courseData.skills.values,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(59, 130, 246, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#d1d5db' },
                            grid: { color: '#e5e7eb' },
                            pointLabels: { font: { size: 12 }, color: '#4b5563' },
                            ticks: {
                                backdropColor: 'transparent',
                                stepSize: 2,
                                font: { weight: 'bold' }
                            },
                            suggestedMin: 0,
                            suggestedMax: 10
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Updates the checkboxes based on the completedTasks Set
        function updateTaskCheckboxes() {
            const taskCheckboxes = document.querySelectorAll('.task-item input[type="checkbox"]');
            taskCheckboxes.forEach(checkbox => {
                const taskId = checkbox.dataset.taskId;
                checkbox.checked = completedTasks.has(taskId);
                const span = checkbox.nextElementSibling;
                if (checkbox.checked) {
                    span.classList.add('line-through', 'text-gray-400');
                    span.classList.remove('text-gray-700');
                } else {
                    span.classList.remove('line-through', 'text-gray-400');
                    span.classList.add('text-gray-700');
                }
            });
        }

        function attachModuleListeners() {
            const moduleHeaders = document.querySelectorAll('.module-header');
            moduleHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('span');
                    
                    if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                        content.style.maxHeight = '0px';
                        icon.style.transform = 'rotate(0deg)';
                    } else {
                        // Close other open modules
                        document.querySelectorAll('.module-content').forEach(c => c.style.maxHeight = '0px');
                        document.querySelectorAll('.module-header span').forEach(i => i.style.transform = 'rotate(0deg)');
                        
                        content.style.maxHeight = content.scrollHeight + "px";
                        icon.style.transform = 'rotate(180deg)';
                    }
                });
            });

            const taskCheckboxes = document.querySelectorAll('.task-item input[type="checkbox"]');
            taskCheckboxes.forEach(checkbox => {
                const taskId = checkbox.dataset.taskId;
                // Initial state update
                checkbox.checked = completedTasks.has(taskId);
                const span = checkbox.nextElementSibling;
                if (checkbox.checked) {
                    span.classList.add('line-through', 'text-gray-400');
                    span.classList.remove('text-gray-700');
                } else {
                    span.classList.remove('line-through', 'text-gray-400');
                    span.classList.add('text-gray-700');
                }

                checkbox.addEventListener('change', async (e) => {
                    const taskId = e.target.dataset.taskId;
                    if (e.target.checked) {
                        completedTasks.add(taskId);
                    } else {
                        completedTasks.delete(taskId);
                    }
                    await window.saveCompletedTasks(); // Save to Firestore (or locally if not configured)
                });
            });
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                const target = e.target.dataset.target;
                
                navLinks.forEach(l => l.classList.remove('active'));
                e.target.classList.add('active');
                
                renderContent(target);
            });
        });

        // Initial render and data loading after Firebase is ready
        window.addEventListener('load', async () => {
            renderContent('dashboard'); // Render initial content (charts might not have data yet)
            // Firebase authentication and data loading handled by onAuthStateChanged
            // The onAuthStateChanged listener will call loadCompletedTasks and updateProgressChart
            // once authentication is complete, and then hide the loading indicator.
            window.setupFirestoreListener(); // Start real-time listener
        });
    </script>
</body>
</html>
